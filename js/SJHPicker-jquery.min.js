Date.prototype.Format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};var SJHPicker={start_day:1,selected_date:null,min_date:null,max_date:null,format:null,init:function(a){if(a!=undefined){if(a.max_date!=null){if(isNaN(new Date(a.max_date).getDay())){console.error('"'+a.max_date+'"格式不正确')}SJHPicker.max_date=a.max_date}if(a.min_date!=null){if(isNaN(new Date(a.min_date).getDay())){console.error('"'+a.min_date+'"格式不正确')}SJHPicker.min_date=a.min_date}if(new Date(a.min_date)>new Date(a.max_date)){SJHPicker.min_date=null;SJHPicker.max_date=null;throw new Error("下限日期不能晚于上限日期")}if(a.selected_date!=null){if(isNaN(new Date(a.selected_date).getDay())){console.error('"'+a.selected_date+'"格式不正确')}SJHPicker.selected_date=new Date(a.selected_date).Format("yyyy-MM-d")}if(a.start_day!=null){if(parseInt(a.start_day)==NaN){console.error('"'+a.start_day+'"格式不正确')}SJHPicker.start_day=a.start_day}if(a.format!=null){if(isNaN(new Date(new Date().Format(a.format)).getDay())){console.warn('格式"'+a.format+'"可能会引发错误')}SJHPicker.format=a.format}}$("input[data-field=date]").click(function(){SJHPicker.show(this)})},show:function(a){var c;if(a.value.length>0){c=new Date(a.value)}else{c=new Date(new Date().Format("yyyy-MM-d"))}if(SJHPicker.min_date!=null){var b=new Date(SJHPicker.min_date);if(c<b){c=b}}if(SJHPicker.min_date!=null){var b=new Date(SJHPicker.max_date);if(a>b){c=b}}SJHPicker.selected_date=c.Format("yyyy-MM-d");SJHPicker.generate_panel(c.getFullYear(),c.getMonth()+1,c.getDate());$("#SJHPicker").css("display","flex");$("#sjhpicker_btn_confirm").click(function(){SJHPicker.confirm(a)})},cancel:function(){$("#SJHPicker").hide()},confirm:function(a){if(SJHPicker.format!=null){a.value=new Date(SJHPicker.selected_date).Format(SJHPicker.format)}else{a.value=SJHPicker.selected_date}$("#SJHPicker").hide()},generate_panel:function(l,f,k){var j=$("#SJHPicker");if(j==null){return}var n='<div id="sjhpicker_panel" onselectstart="return false;" unselectable="on">';n+='<div id="sjhpicker_title">选择日期</div>';var c='<div id="sjhpicker_btn_preyear"></div>';var b='<div id="sjhpicker_btn_premonth"></div>';var a='<div id="sjhpicker_btn_nextmonth"></div>';var e='<div id="sjhpicker_btn_nextyear"></div>';n+='<div id="sjhpicker_myselector">'+c+b;n+='<div id="sjhpicker_myvalue">'+l+" 年 "+f+" 月</div>";n+=a+e+"</div>";n+='<div id="sjhpicker_days">';days=["日","一","二","三","四","五","六"];var h=this.start_day;for(var g=0;g<=6;++g){n+='<div class="sjhpicker_day">'+days[h%7]+"</div>";++h}n+="</div>";n+='<div id="sjhpicker_dselector"></div>';n+='<div id="sjhpicker_btnrow"><div id="sjhpicker_btn_today">今日</div><div id="sjhpicker_btn_confirm">确认</div><div id="sjhpicker_btn_cancel">取消</div></div>';n+="</div>";j.html(n);this.generate_date_of_month(l,f,k);$("#sjhpicker_btn_premonth").click(this.pre_month);$("#sjhpicker_btn_preyear").click(this.pre_year);$("#sjhpicker_btn_nextmonth").click(this.next_month);$("#sjhpicker_btn_nextyear").click(this.next_year);$("#sjhpicker_btn_today").click(this.select_today);$("#sjhpicker_btn_cancel").click(this.cancel)},generate_date_of_month:function(k,e,i){var l=new Date(k+"/"+e+"/1");var c;if(e+1<=12){c=new Date(k+"/"+(e+1)+"/1")}else{c=new Date((k+1)+"/1/1")}c.setDate(c.getDate()-1);var b="";while(l.getDay()!=this.start_day){l.setDate(l.getDate()-1)}var g=new Date(k+"/"+(e)+"/1");if(this.min_date!=null){var f=new Date(this.min_date);if(f.getFullYear()==k&&f.getMonth()+1==e){g=f}}var a=new Date(c.Format("yyyy-MM-d"));if(this.max_date!=null){var f=new Date(this.max_date);if(f.getFullYear()==k&&f.getMonth()+1==e){a=f}}do{if(l.getDay()==this.start_day){b+="<div class=sjhpicker_dayrow>"}if(l<g||l>a){b+=('<div class="sjhpicker_date_disabled" id="sjhpicker_date_'+l.Format("yyyy-MM-d")+'">'+l.getDate().toString()+"</div>")}else{b+=('<div class="sjhpicker_date" id="sjhpicker_date_'+l.Format("yyyy-MM-d")+'">'+l.getDate().toString()+"</div>")}if(l.getDay()==(this.start_day+6)%7){b+="</div>"}l.setDate(l.getDate()+1)}while(l<=c);l.setDate(l.getDate()-1);while(l.getDay()!=(this.start_day+6)%7){l.setDate(l.getDate()+1);b+=('<div class="sjhpicker_date_disabled" id="sjhpicker_date_'+l.Format("yyyy-MM-d")+'">'+l.getDate().toString()+"</div>");if(l.getDay()==(this.start_day+6)%7){b+="</div>"}}$("#sjhpicker_dselector").html(b);var j=new Date(new Date().Format("yyyy-MM-d"));if(j>=g&&j<=a){$("#sjhpicker_date_"+j.Format("yyyy-MM-d")).css("background-color","#ddd")}$(".sjhpicker_date").click(function(){SJHPicker.selected_date=this.id.substr(15);btn_dates_notToday=$(".sjhpicker_date:not(#sjhpicker_date_"+j.Format("yyyy-MM-d")+")");btn_dates_notToday.css("background-color","rgba(0, 0, 0, 0)");$("#sjhpicker_date_"+j.Format("yyyy-MM-d")).css("background-color","#ddd");$(this).css("background-color","#F2BE45")});var h=k+" 年 "+e+" 月";$("#sjhpicker_myvalue").text(h);$("#sjhpicker_date_"+this.selected_date).css("background-color","#F2BE45");if(e==new Date(this.min_date).getMonth()+1&&k==new Date(this.min_date).getFullYear()){$("#sjhpicker_btn_premonth").css("visibility","hidden");$("#sjhpicker_btn_preyear").css("visibility","hidden")}else{if(k==new Date(this.min_date).getFullYear()){$("#sjhpicker_btn_premonth").css("visibility","inherit");$("#sjhpicker_btn_preyear").css("visibility","hidden")}else{$("#sjhpicker_btn_premonth").css("visibility","inherit");$("#sjhpicker_btn_preyear").css("visibility","inherit")}}if(e==new Date(this.max_date).getMonth()+1&&k==new Date(this.max_date).getFullYear()){$("#sjhpicker_btn_nextmonth").css("visibility","hidden");$("#sjhpicker_btn_nextyear").css("visibility","hidden")}else{if(k==new Date(this.max_date).getFullYear()){$("#sjhpicker_btn_nextmonth").css("visibility","inherit");$("#sjhpicker_btn_nextyear").css("visibility","hidden")}else{$("#sjhpicker_btn_nextmonth").css("visibility","inherit");$("#sjhpicker_btn_nextyear").css("visibility","inherit")}}},getCurrentMonth:function(){var a=$("#sjhpicker_myvalue").text();return new Date(a.substr(0,4)+"/"+a.substr(7,2)+"/1")},next_month:function(){var a=SJHPicker.getCurrentMonth();a.setMonth(a.getMonth()+1);SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},next_year:function(){var a=SJHPicker.getCurrentMonth();a.setFullYear(a.getFullYear()+1);if(a.getMonth()>new Date(SJHPicker.max_date).getMonth()){a.setMonth(new Date(SJHPicker.max_date).getMonth())}SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},pre_month:function(){var a=SJHPicker.getCurrentMonth();a.setMonth(a.getMonth()-1);SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},pre_year:function(){var a=SJHPicker.getCurrentMonth();a.setFullYear(a.getFullYear()-1);if(a.getMonth()<new Date(SJHPicker.min_date).getMonth()){a.setMonth(new Date(SJHPicker.min_date).getMonth())}SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},select_today:function(){SJHPicker.setSelectedDate(new Date())},setSelectedDate:function(a){SJHPicker.selected_date=a.Format("yyyy-MM-d");SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1,a.getDate())}};