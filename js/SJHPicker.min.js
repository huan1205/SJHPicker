/*!
 * SJHPicker v0.1.0 (https://github.com/ExTEnS10N/SJHPicker)
 * Copyright 2016 TurboExtension.
 * Licensed under the MIT license
 */
Date.prototype.Format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};var SJHPicker={start_day:1,selected_date:null,min_date:null,max_date:null,format:null,init:function(c){if(c!=undefined){if(c.max_date!=null){if(isNaN(new Date(c.max_date).getDay())){console.error('"'+c.max_date+'"格式不正确')}SJHPicker.max_date=c.max_date}if(c.min_date!=null){if(isNaN(new Date(c.min_date).getDay())){console.error('"'+c.min_date+'"格式不正确')}SJHPicker.min_date=c.min_date}if(new Date(c.min_date)>new Date(c.max_date)){SJHPicker.min_date=null;SJHPicker.max_date=null;throw new Error("下限日期不能晚于上限日期")}if(c.selected_date!=null){if(isNaN(new Date(c.selected_date).getDay())){console.error('"'+c.selected_date+'"格式不正确')}SJHPicker.selected_date=new Date(c.selected_date).Format("yyyy-MM-d")}if(c.start_day!=null){if(parseInt(c.start_day)==NaN){console.error('"'+c.start_day+'"格式不正确')}SJHPicker.start_day=c.start_day}if(c.format!=null){if(isNaN(new Date(new Date().Format(c.format)).getDay())){console.warn('格式"'+c.format+'"可能会引发错误')}SJHPicker.format=c.format}}var a=document.getElementsByTagName("input");for(var b=0;b<a.length;++b){if(a[b].getAttribute("data-field")=="date"){a[b].onclick=function(){SJHPicker.show(this)}}}},show:function(a){var c;if(a.value.length>0){c=new Date(a.value)}else{c=new Date(new Date().Format("yyyy-MM-d"))}if(SJHPicker.min_date!=null){var b=new Date(SJHPicker.min_date);if(c<b){c=b}}if(SJHPicker.min_date!=null){var b=new Date(SJHPicker.max_date);if(a>b){c=b}}SJHPicker.selected_date=c.Format("yyyy-MM-d");SJHPicker.generate_panel(c.getFullYear(),c.getMonth()+1,c.getDate());document.getElementById("SJHPicker").style.display="flex";document.getElementById("sjhpicker_btn_confirm").onclick=function(){SJHPicker.confirm(a)}},cancel:function(){document.getElementById("SJHPicker").style.display="none"},confirm:function(a){if(SJHPicker.format!=null){a.value=new Date(SJHPicker.selected_date).Format(SJHPicker.format)}else{a.value=SJHPicker.selected_date}document.getElementById("SJHPicker").style.display="none"},generate_panel:function(l,f,k){var j=document.getElementById("SJHPicker");if(j==null){return}var n='<div id="sjhpicker_panel" onselectstart="return false;" unselectable="on">';n+='<div id="sjhpicker_title">选择日期</div>';var c='<div id="sjhpicker_btn_preyear"></div>';var b='<div id="sjhpicker_btn_premonth"></div>';var a='<div id="sjhpicker_btn_nextmonth"></div>';var e='<div id="sjhpicker_btn_nextyear"></div>';n+='<div id="sjhpicker_myselector">'+c+b;n+='<div id="sjhpicker_myvalue">'+l+" 年 "+f+" 月</div>";n+=a+e+"</div>";n+='<div id="sjhpicker_days">';days=["日","一","二","三","四","五","六"];var h=this.start_day;for(var g=0;g<=6;++g){n+='<div class="sjhpicker_day">'+days[h%7]+"</div>";++h}n+="</div>";n+='<div id="sjhpicker_dselector"></div>';n+='<div id="sjhpicker_btnrow"><div id="sjhpicker_btn_today">今日</div><div id="sjhpicker_btn_confirm">确认</div><div id="sjhpicker_btn_cancel">取消</div></div>';n+="</div>";j.innerHTML=n;this.generate_date_of_month(l,f,k);document.getElementById("sjhpicker_btn_premonth").onclick=this.pre_month;document.getElementById("sjhpicker_btn_preyear").onclick=this.pre_year;document.getElementById("sjhpicker_btn_nextmonth").onclick=this.next_month;document.getElementById("sjhpicker_btn_nextyear").onclick=this.next_year;document.getElementById("sjhpicker_btn_today").onclick=this.select_today;document.getElementById("sjhpicker_btn_cancel").onclick=this.cancel},generate_date_of_month:function(q,e,n){var r=new Date(q+"/"+e+"/1");var c;if(e+1<=12){c=new Date(q+"/"+(e+1)+"/1")}else{c=new Date((q+1)+"/1/1")}c.setDate(c.getDate()-1);var b="";while(r.getDay()!=this.start_day){r.setDate(r.getDate()-1)}var k=new Date(q+"/"+(e)+"/1");if(this.min_date!=null){var h=new Date(this.min_date);if(h.getFullYear()==q&&h.getMonth()+1==e){k=h}}var a=new Date(c.Format("yyyy-MM-d"));if(this.max_date!=null){var h=new Date(this.max_date);if(h.getFullYear()==q&&h.getMonth()+1==e){a=h}}do{if(r.getDay()==this.start_day){b+="<div class=sjhpicker_dayrow>"}if(r<k||r>a){b+=('<div class="sjhpicker_date_disabled" id="sjhpicker_date_'+r.Format("yyyy-MM-d")+'">'+r.getDate().toString()+"</div>")}else{b+=('<div class="sjhpicker_date" id="sjhpicker_date_'+r.Format("yyyy-MM-d")+'">'+r.getDate().toString()+"</div>")}if(r.getDay()==(this.start_day+6)%7){b+="</div>"}r.setDate(r.getDate()+1)}while(r<=c);r.setDate(r.getDate()-1);while(r.getDay()!=(this.start_day+6)%7){r.setDate(r.getDate()+1);b+=('<div class="sjhpicker_date_disabled" id="sjhpicker_date_'+r.Format("yyyy-MM-d")+'">'+r.getDate().toString()+"</div>");if(r.getDay()==(this.start_day+6)%7){b+="</div>"}}document.getElementById("sjhpicker_dselector").innerHTML=b;var o=new Date(new Date().Format("yyyy-MM-d"));if(o>=k&&o<=a){var g=document.getElementById("sjhpicker_date_"+o.Format("yyyy-MM-d"));if(g!=null){g.style.backgroundColor="#ddd"}}var j=document.getElementsByClassName("sjhpicker_date");for(var f=0;f<j.length;++f){j[f].onclick=function(){SJHPicker.selected_date=this.id.substr(15);for(var d=0;d<j.length;++d){if(j[d]!=g){j[d].style.backgroundColor="rgba(0, 0, 0, 0)"}else{j[d].style.backgroundColor="#ddd"}}this.style.backgroundColor="#F2BE45"}}var l=q+" 年 "+e+" 月";document.getElementById("sjhpicker_myvalue").textContent=l;var p=document.getElementById("sjhpicker_date_"+this.selected_date);if(p!=null){p.style.backgroundColor="#F2BE45"}if(e==new Date(this.min_date).getMonth()+1&&q==new Date(this.min_date).getFullYear()){document.getElementById("sjhpicker_btn_premonth").style.visibility="hidden";document.getElementById("sjhpicker_btn_preyear").style.visibility="hidden"}else{if(q==new Date(this.min_date).getFullYear()){document.getElementById("sjhpicker_btn_premonth").style.visibility="inherit";document.getElementById("sjhpicker_btn_preyear").style.visibility="hidden"}else{document.getElementById("sjhpicker_btn_premonth").style.visibility="inherit";document.getElementById("sjhpicker_btn_preyear").style.visibility="inherit"}}if(e==new Date(this.max_date).getMonth()+1&&q==new Date(this.max_date).getFullYear()){document.getElementById("sjhpicker_btn_nextmonth").style.visibility="hidden";document.getElementById("sjhpicker_btn_nextyear").style.visibility="hidden"}else{if(q==new Date(this.max_date).getFullYear()){document.getElementById("sjhpicker_btn_nextmonth").style.visibility="inherit";document.getElementById("sjhpicker_btn_nextyear").style.visibility="hidden"}else{document.getElementById("sjhpicker_btn_nextmonth").style.visibility="inherit";document.getElementById("sjhpicker_btn_nextyear").style.visibility="inherit"}}},getCurrentMonth:function(){var a=document.getElementById("sjhpicker_myvalue").textContent;return new Date(a.substr(0,4)+"/"+a.substr(7,2)+"/1")},next_month:function(){var a=SJHPicker.getCurrentMonth();a.setMonth(a.getMonth()+1);SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},next_year:function(){var a=SJHPicker.getCurrentMonth();a.setFullYear(a.getFullYear()+1);if(a.getMonth()>new Date(SJHPicker.max_date).getMonth()){a.setMonth(new Date(SJHPicker.max_date).getMonth())}SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},pre_month:function(){var a=SJHPicker.getCurrentMonth();a.setMonth(a.getMonth()-1);SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},pre_year:function(){var a=SJHPicker.getCurrentMonth();a.setFullYear(a.getFullYear()-1);if(a.getMonth()<new Date(SJHPicker.min_date).getMonth()){a.setMonth(new Date(SJHPicker.min_date).getMonth())}SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1)},select_today:function(){SJHPicker.setSelectedDate(new Date())},setSelectedDate:function(a){SJHPicker.selected_date=a.Format("yyyy-MM-d");SJHPicker.generate_date_of_month(a.getFullYear(),a.getMonth()+1,a.getDate())}};